<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>IDICå®éªŒå®¤</title>
    <link rel="stylesheet" href="style.css">

    <style>
            .message-context-menu { position: fixed; background: #fff; border: 1px solid #e0e0e0; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 5px; z-index: 1000; display: none; }
            .context-menu-item { padding: 8px 12px; cursor: pointer; font-size: 14px; border-radius: 5px; }
            .context-menu-item:hover { background-color: #f0f0f0; }
            .quoted-message-display { display: block; background-color: rgba(0,0,0,0.05); padding: 6px 10px; margin: -2px -2px 8px; border-radius: 8px 8px 0 0; font-size: 13px; color: #555; border-left: 3px solid var(--main-theme-color, #3B83A2);  }
            .quoted-message-display .sender-name { font-weight: bold; }
            .quoted-message-display .message-snippet { display: block; opacity: 0.8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
            .reply-indicator { background-color: #f0f4f8; padding: 5px 10px; font-size: 12px; color: #333; display: none; align-items: center; justify-content: space-between; }
            .reply-indicator-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
            .cancel-reply-btn { cursor: pointer; font-size: 16px; font-weight: bold; padding: 0 5px; }
            .message-recalled { color: #888; font-size: 12px; text-align: center; padding: 10px 0; width: 100%; }
            .recalled-edit-btn { color: #3B83A2; cursor: pointer; margin-left: 5px; }
        </style>
</head>
<body>
    <div id="app-wrapper"></div>
    <!-- â–¼â–¼â–¼â–¼â–¼ ã€å…¨æ–°ã€‘ä¾§æ»‘èœå• (ä¸ªäººä¸­å¿ƒ) â–¼â–¼â–¼â–¼â–¼ -->
    <div id="side-menu" class="side-menu">
        <div class="side-menu-profile">
            <img id="side-menu-avatar" class="avatar-large" src="https://i.postimg.cc/cLPP10Vm/4.jpg">
            <span id="side-menu-username">ä½ çš„æ˜µç§°</span>
            <!-- å¯ä»¥åœ¨è¿™é‡ŒåŠ æ›´å¤šä¸ªäººä¿¡æ¯ -->
        </div>
        <div class="side-menu-list">
            <div class="side-menu-item" id="side-menu-wallet">
                <span class="menu-icon">ğŸ’°</span>
                <span>é’±åŒ…</span>
            </div>
            <div class="side-menu-item" id="side-menu-accounting">
                <span class="menu-icon">ğŸ§¾</span>
                <span>è®°è´¦</span>
            </div>
            <div class="side-menu-item" id="side-menu-favorites">
                <span class="menu-icon">â­</span>
                <span>æ”¶è—</span>
            </div>
            <div class="side-menu-item" id="side-menu-themes">
                <span class="menu-icon">ğŸ¨</span>
                <span>ä¸ªæ€§è£…æ‰®</span>
            </div>
        </div>
        <div class="side-menu-footer">
            <span>è®¾ç½®</span>
            <span>å¤œé—´</span>
            <span>--_--</span>
        </div>
    </div>
    <!-- â–²â–²â–²â–²â–² ä¾§æ»‘èœå•ç»“æŸ â–²â–²â–²â–²â–² -->
    <div id="message-context-menu" class="message-context-menu">
        <div class="context-menu-item" id="context-menu-reply">å¼•ç”¨</div>
        <div class="context-menu-item" id="context-menu-recall">æ’¤å›</div>
    </div>

    <!-- ã€ã€ã€å…¨æ–°ï¼šå…¨å±€Toastæç¤ºã€‘ã€‘ã€‘ -->
    <div id="global-toast" class="hidden">
        <span id="global-toast-text"></span>
    </div>

    <div id="app-container">

        <!-- è§†å›¾1: æ¶ˆæ¯åˆ—è¡¨ (é»˜è®¤è§†å›¾) -->
        <div id="chat-list-view" class="view hidden">
            <div class="main-header">
                <div id="main-header-user-info" class="user-info-bar">
                    <img id="main-header-avatar" class="avatar" src="https://i.postimg.cc/cLPP10Vm/4.jpg">
                    <div class="user-details">
                        <span id="main-header-username">ä½ çš„æ˜µç§°</span>
                        <span class="user-status"><span class="status-dot"></span>åœ¨çº¿ - 5G</span>
                    </div>
                </div>
                <button id="add-contact-button" class="header-button">+</button>
            </div>
            <div class="search-bar-container">
                <input type="text" class="search-input" placeholder="ğŸ” æœç´¢">
            </div>
            <div id="chat-list-container" class="chat-list">
                <!-- èŠå¤©åˆ—è¡¨å°†ç”±JSåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
            </div>
        </div>

        <!-- è§†å›¾2: èŠå¤©çª—å£ -->
        <div id="chat-window-view" class="view hidden">
            <div class="header">
                <div id="chat-header-normal">
                    <button id="back-to-list-button" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                    <div id="chat-header-info">
                        <span id="chat-ai-name" class="clickable">AI ä¼™ä¼´</span>
                        <div id="chat-ai-status-line">
                            <span class="online-indicator"></span>
                            <span id="chat-ai-status">åœ¨çº¿</span>
                            <span id="chat-ai-activity-status"></span>
                        </div>
                    </div>
                    <button id="chat-settings-button" class="header-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
                </div>
                <div id="chat-header-select" class="chat-header-actions hidden">
                <button id="cancel-select-button" class="header-button">å–æ¶ˆ</button>
                <span id="select-count"></span>
                <div class="header-action-buttons">
                    <button id="recall-selected-button" class="header-button" title="æ’¤å›">æ’¤å›</button>
                    <button id="reply-selected-button" class="header-button" title="å¼•ç”¨">å¼•ç”¨</button>
                    <button id="edit-selected-button" class="header-button" title="ç¼–è¾‘">ç¼–è¾‘</button>
                    <button id="delete-selected-button" class="header-button" title="åˆ é™¤">åˆ é™¤</button>
                </div>
            </div>
            </div>
            <div id="message-container"></div>
            <div id="ai-suggestion-panel" class="suggestion-panel hidden">
            </div>
            <div class="chat-input-area">
                <div id="refresh-suggestions-container" class="hidden">
                    <button id="refresh-suggestions-btn" title="æ¢ä¸€æ‰¹"></button>
                </div>
                <div class="chat-functions-toolbar">
                    <button id="voice-btn" class="tool-button" title="è¯­éŸ³"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg></button>
                    <button id="image-btn" class="tool-button" title="å›¾ç‰‡"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></button>
                    <button id="camera-btn" class="tool-button" title="æ‹æ‘„"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg></button>
                    <button id="red-packet-btn" class="tool-button" title="çº¢åŒ…"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.2c-5.5 0-10 2.4-10 6.8 0 2.4.6 4.6 2.4 6.4 1.8 2 4.2 2.6 4.2 4.6 0 1.1.9 2 2 2h2.8c1.1 0 2-.9 2-2 0-2 2.4-2.6 4.2-4.6 1.8-1.8 2.4-4 2.4-6.4 0-4.4-4.5-6.8-10-6.8z"></path><path d="M12 12.6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg></button>
                    <button id="emoji-btn" class="tool-button" title="è¡¨æƒ…"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg></button>
                    <button id="ai-helper-button" class="tool-button" title="AIå¸®å›"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"></path><rect x="4" y="4" width="16" height="16" rx="2"></rect><path d="M20 12h-4"></path><path d="M12 20v-4"></path></svg></button>
                    <button id="more-functions-button" class="tool-button" title="æ›´å¤š"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></button>
                </div>
                <div id="reply-indicator" class="reply-indicator">
                    <span id="reply-indicator-text"></span>
                    <span id="cancel-reply-btn" title="å–æ¶ˆå›å¤">&times;</span>
                </div>
                <div class="input-row">
                    <textarea id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..."></textarea>
                    <button id="send-button">å‘é€</button>
                </div>
            </div>
            <div id="user-sticker-panel" class="sticker-panel"></div>
        </div>
        
        <!-- è§†å›¾3: åŠ¨æ€é¡µé¢ -->
        <div id="moments-view" class="view hidden">
            <div class="header">
                 <button id="back-to-list-from-moments" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>åŠ¨æ€</span>
            </div>
            <div class="moments-container">
                <div class="moments-header">
                    <img class="moments-banner" src="https://i.postimg.cc/L8y2zWc2/default-banner.jpg" alt="banner">
                    <div class="moments-user-info">
                        <span id="moments-user-name">ä½ çš„æ˜µç§°</span>
                        <img id="moments-user-avatar" class="avatar-lg" src="">
                    </div>
                </div>
                <div class="moments-nav">
                    <span>ç›¸å†Œ</span>
                    <span>è¯´è¯´</span>
                    <span>è£…æ‰®</span>
                    <span>æ¸¸æˆ</span>
                </div>
                <div class="moments-feed"></div>
                 <button id="create-post-button" class="fab">+</button>
            </div>
        </div>

        <!-- è§†å›¾4: è®¾ç½®é¡µé¢ (é€šç”¨è®¾ç½®) -->
        <div id="settings-view" class="view hidden">
            <div class="header">
                 <button id="back-to-list-from-settings" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>è®¾ç½®</span>
            </div>
            <div id="settings-form">
                <div class="form-group"><label for="api-type-select">API ç±»å‹</label><select id="api-type-select"><option value="openai_proxy">OpenAI æ ¼å¼ (æ¨è)</option><option value="gemini_direct" disabled>Google Gemini (æš‚ä¸æ¨è)</option></select></div>
                <div class="form-group"><label for="api-url-input">API åœ°å€ (URL)</label><input type="text" id="api-url-input" placeholder="æ ¹æ®æ‰€é€‰ç±»å‹å¡«å†™"></div>
                <div class="form-group" id="model-area"><label>æ¨¡å‹åç§° (Model)</label><div class="model-selection-area"><select id="api-model-select"></select><button id="fetch-models-button">æ‹‰å–</button></div></div>
                <div class="form-group"><label for="api-key-input">API å¯†é’¥ (Key)</label><input type="password" id="api-key-input" placeholder="ç²˜è´´ä½ çš„å¯†é’¥"></div>
                <div class="form-group">
                    <label for="context-limit-input">ä¸Šä¸‹æ–‡è®°å¿†æ¡æ•°</label>
                    <input type="number" id="context-limit-input" placeholder="">
                </div>
                <hr>
                <h3>å…¨å±€è®¾ç½® (å¾…å¼€å‘)</h3>
                <p class="placeholder-text">æœªæ¥å¯åœ¨è¿™é‡Œæ·»åŠ å…¨å±€é¢„è®¾ã€å¤–è§‚ç­‰è®¾ç½®ã€‚</p>
                <button id="save-settings-button">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>

        <!-- è§†å›¾5: å•ä¸ªè”ç³»äººçš„èŠå¤©è®¾ç½®é¡µé¢ -->
        <div id="contact-settings-view" class="view hidden">
            <div class="header">
                 <button id="back-to-chat-button" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>èŠå¤©è®¾ç½®</span>
            </div>
            <div class="contact-settings-container">
                <div class="settings-group">
                    <div class="settings-item contact-profile" id="cs-edit-ai-profile">
                        <img id="cs-contact-avatar" class="avatar" src="">
                        <span>å¯¹æ–¹ä¿¡æ¯</span>
                        <span class="arrow">&gt;</span>
                    </div>
                    <div class="settings-item contact-profile" id="cs-edit-my-profile">
                        <img id="cs-my-avatar" class="avatar" src="">
                        <span>æˆ‘çš„èº«ä»½</span>
                        <span class="arrow">&gt;</span>
                    </div>
                </div>
                <div class="settings-group">
                    <div class="settings-item"><span>è®¾ä¸ºç½®é¡¶</span><label class="switch"><input type="checkbox" id="cs-pin-toggle"><span class="slider"></span></label></div>
                    <div class="settings-item">
                        <span>å…è®¸AIä¸»åŠ¨æ±‚çˆ±</span>
                        <label class="switch"><input type="checkbox" id="cs-propose-toggle"><span class="slider"></span></label>
                    </div>
                    <div class="settings-item"><span>å¯¼å‡º/å¯¼å…¥èŠå¤©è®°å½•</span><span class="arrow">&gt;</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item"><span>è®¾ç½®AIåŠ¨æ€é¢‘ç‡</span><span class="arrow">&gt;</span></div>
                    <div class="settings-item"><span>è®¾ç½®AIä¸»åŠ¨æ¶ˆæ¯é¢‘ç‡</span><span class="arrow">&gt;</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item"><span>è®¾ç½®èŠå¤©èƒŒæ™¯</span><span class="arrow">&gt;</span></div>
                    <div class="settings-item"><span>è®¾ç½®æ°”æ³¡æ ·å¼</span><span class="arrow">&gt;</span></div>
                    <div class="settings-item"><span>è®¾ç½®å­—ä½“å¤§å°</span><span class="arrow">&gt;</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item" id="cs-message-count-item">
                        <span>å½“å‰å¯¹è¯æ¡æ•°</span>
                        <span id="cs-message-count">0</span>
                    </div>
                    <div class="settings-item">
                        <span>è‡ªåŠ¨æ€»ç»“</span>
                        <div class="auto-summary-setting">
                            <div id="cs-auto-summary-display" class="summary-threshold-display">æœªè®¾ç½®</div>
                            <input type="number" id="cs-auto-summary-input" class="summary-threshold-input hidden" min="50">
                            <label class="switch"><input type="checkbox" id="cs-auto-summary-toggle"><span class="slider"></span></label>
                        </div>
                    </div>
                    <div class="settings-item" id="cs-summarize-chat">
                        <span>æ‰‹åŠ¨æ€»ç»“</span>
                        <span class="arrow">&gt;</span>
                    </div>
                </div>
                <div class="settings-group">
                    <div class="settings-item" id="cs-clear-history"><span class="danger">æ¸…ç©ºèŠå¤©è®°å½•</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item" id="cs-blacklist-contact"><span class="danger">å°†å¯¹æ–¹æ·»åŠ è‡³é»‘åå•</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item" id="cs-delete-contact">
                        <span class="danger">åˆ é™¤è¯¥è§’è‰²</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è§†å›¾6: AIä¿¡æ¯ç¼–è¾‘é¡µé¢ -->
        <div id="ai-editor-view" class="view hidden">
            <div class="header">
                <button id="back-to-contact-settings-button" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>ç¼–è¾‘AIä¿¡æ¯</span>
            </div>
            <div id="ai-editor-form">
                <div class="form-group-horizontal">
                    <div class="form-group avatar-group">
                        <label>AI å¤´åƒ</label>
                        <div class="image-upload-area avatar-upload" id="avatar-upload-area">
                            <img id="avatar-preview" class="image-preview" src="">
                            <span>ç‚¹å‡»ä¸Šä¼ </span>
                        </div>
                        <input type="file" id="avatar-upload-input" class="hidden-file-input" accept="image/*">
                    </div>
                    <div class="form-group photo-group">
                        <label>AI ç…§ç‰‡</label>
                        <div class="image-upload-area photo-upload" id="photo-upload-area">
                            <img id="photo-preview" class="image-preview" src="">
                            <span>ç‚¹å‡»ä¸Šä¼ </span>
                        </div>
                        <input type="file" id="photo-upload-input" class="hidden-file-input" accept="image/*">
                    </div>
                </div>
                <div class="form-group">
                    <label for="ai-editor-name">AI å§“å</label>
                    <input type="text" id="ai-editor-name">
                </div>
                <div class="form-group">
                    <label for="ai-editor-remark">AI å¤‡æ³¨</label>
                    <input type="text" id="ai-editor-remark">
                </div>
                <div class="form-group">
                    <label for="ai-editor-persona">AIçš„äººè®¾</label>
                    <textarea id="ai-editor-persona" rows="5"></textarea>
                </div>
                <div class="form-group">
                    <label for="ai-editor-chat-style">çº¿ä¸Šé£æ ¼</label>
                    <textarea id="ai-editor-chat-style" rows="4" placeholder="e.g., å–œæ¬¢ç”¨çŸ­å¥ï¼Œå¶å°”ä¼šå‘å¯çˆ±çš„Emojiã€é¢œæ–‡å­—å’Œè¡¨æƒ…åŒ…ã€‚ä¸çˆ±å‘è¯­éŸ³ï¼Œæ‰“å­—å¾ˆå¿«ã€‚è¯´è¯ç›´æ¥ï¼Œä¸å–œæ¬¢æ‹å¼¯æŠ¹è§’ã€‚"></textarea>
                </div>
                <div class="form-group"><label>AIçš„ä¸“å±è®°å¿†</label><textarea id="ai-editor-memory" rows="8" placeholder="å¯¹è¯æ€»ç»“ç­‰é•¿æœŸè®°å¿†..."></textarea></div>
                <div class="form-group">
                    <label>ä¸–ç•Œä¹¦</label>
                    <div id="ai-editor-worldbook"></div>
                    <button type="button" id="add-worldbook-entry-button">æ·»åŠ æ–°æ¡ç›®</button>
                </div>
                <div class="form-group">
                    <label>å¯ç”¨è¡¨æƒ…åŒ…åˆ†ç»„</label>
                    <div id="ai-sticker-groups-container">
                        <p class="placeholder-text">è¯·å…ˆåœ¨ å…¨å±€è®¾ç½® -> AIè¡¨æƒ…åŒ…ç®¡ç† ä¸­æ·»åŠ åˆ†ç»„</p>
                    </div>
                </div>
                <button id="save-ai-profile-button">ä¿å­˜</button>
            </div>
        </div>

        <!-- è§†å›¾7: AIè¡¨æƒ…åŒ…ç®¡ç†é¡µé¢ -->
        <div id="ai-sticker-manager-view" class="view hidden">
            <div class="header">
                <button id="back-to-settings-from-sticker-btn" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>AIè¡¨æƒ…åŒ…ç®¡ç†</span>
            </div>
            <div id="sticker-manager-container"></div>
            <button id="add-sticker-group-btn" class="fab">+</button>
        </div>

        </div> <!-- â–²â–²â–² #app-container åˆ°æ­¤å½»åº•ç»“æŸ â–²â–²â–² -->

    <!-- ã€ã€ã€æ ¸å¿ƒç»ˆæä¿®å¤ï¼šå¯¼èˆªæ ç°åœ¨æ˜¯ app-container çš„å…„å¼Ÿï¼ã€‘ã€‘ã€‘ -->
    <div id="app-nav">
        <div class="nav-button active" data-view="chat-list-view">æ¶ˆæ¯</div>
        <div class="nav-button" data-view="moments-view">åŠ¨æ€</div>
        <div class="nav-button" data-view="settings-view">è®¾ç½®</div>
    </div>

    <!-- ############################################################### -->
    <!-- #####          æ‰€æœ‰çš„å¼¹çª—(Modal)éƒ½åº”è¯¥æ”¾åœ¨è¿™é‡Œ            ##### -->
    <!-- ############################################################### -->


    <!-- ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹å¼¹çª— -->
    <div id="user-profile-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header"><h3>ä¿®æ”¹æˆ‘çš„ä¿¡æ¯</h3><button id="close-modal-button" class="close-button">&times;</button></div>
            <div class="modal-body">
                <div class="form-group">
                    <label>æˆ‘çš„å¤´åƒ</label>
                    <div class="image-upload-area user-avatar-upload" id="user-avatar-upload-area">
                        <img id="user-avatar-preview" class="image-preview" src="">
                        <span>ç‚¹å‡»ä¸Šä¼ </span>
                    </div>
                    <input type="file" id="user-avatar-upload-input" class="hidden-file-input" accept="image/*">
                </div>
                <div class="form-group"><label for="modal-user-name-input">æˆ‘çš„æ˜µç§°</label><input type="text" id="modal-user-name-input"></div>
                <div class="form-group"><label for="modal-user-persona-input">æˆ‘çš„äººè®¾</label><textarea id="modal-user-persona-input" rows="4"></textarea></div>
            </div>
            <div class="modal-footer"><button id="save-profile-button">ä¿å­˜</button></div>
        </div>
    </div> 

    <!-- è¡¨æƒ…åŒ…ä¸Šä¼ å¼¹çª— -->
    <div id="sticker-upload-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="sticker-upload-title">æ·»åŠ è¡¨æƒ…åŒ…</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>è¡¨æƒ…é¢„è§ˆ</label>
                    <div class="image-upload-area sticker-preview-area">
                        <img id="sticker-upload-preview" class="image-preview" src="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="sticker-upload-url-input">å›¾ç‰‡åœ°å€ (URL)</label>
                    <input type="text" id="sticker-upload-url-input" placeholder="ç²˜è´´URLæˆ–é€‰æ‹©æœ¬åœ°æ–‡ä»¶">
                </div>
                 <div class="form-group">
                    <label for="sticker-upload-file-input" class="button-like-label">ä»æœ¬åœ°ä¸Šä¼ </label>
                    <input type="file" id="sticker-upload-file-input" class="hidden-file-input" accept="image/*">
                </div>
                <div class="form-group">
                    <label for="sticker-upload-desc-input">è¡¨æƒ…æè¿° (ç»™AIçœ‹)</label>
                    <textarea id="sticker-upload-desc-input" rows="3" placeholder="ä¾‹å¦‚ï¼šä¸€åªå¾®ç¬‘çš„æŸ´çŠ¬"></textarea>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-sticker-upload-btn" class="modal-button secondary">å–æ¶ˆ</button>
                <button id="confirm-sticker-upload-btn" class="modal-button primary">ä¿å­˜</button>
            </div>
        </div>
    </div>
     
    <!-- å‘é€è¯­éŸ³å¼¹çª— -->
    <div id="voice-input-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å‘é€è¯­éŸ³</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="voice-text-input">è¯·è¾“å…¥ä½ æƒ³è¯´çš„å†…å®¹:</label>
                    <textarea id="voice-text-input" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-voice-button" class="modal-button secondary">å–æ¶ˆ</button>
                <button id="confirm-voice-button" class="modal-button primary">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- AIå›¾ç‰‡æè¿°å¼¹çª— -->
    <div id="ai-image-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç…§ç‰‡æè¿°</h3>
            </div>
            <div class="modal-body">
                <p id="ai-image-description-text"></p>
            </div>
            <div class="modal-footer">
                <button id="close-ai-image-modal-button">å¥½çš„</button>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·ä¸Šä¼ /æ¨¡æ‹Ÿå›¾ç‰‡å¼¹çª— -->
    <div id="image-upload-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="image-upload-title">å‘é€å›¾ç‰‡</h3>
            </div>
            <div class="modal-body">
                <div class="form-group" id="image-preview-area">
                    <div class="image-upload-area" id="user-image-upload-area">
                        <img id="user-image-preview" class="image-preview" src="">
                        <span>ç‚¹å‡»ä¸Šä¼ </span>
                    </div>
                    <input type="file" id="user-image-upload-input" class="hidden-file-input" accept="image/*">
                </div>
                <div class="form-group" id="image-description-group">
                    <textarea id="image-description-input" rows="3" placeholder="å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œæé—®æˆ–è¡¥å……è¯´æ˜..."></textarea>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-image-upload-button" class="modal-button secondary">å–æ¶ˆ</button>
                <button id="confirm-image-upload-button" class="modal-button primary">å‘é€</button>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰ç¡®è®¤å¼¹çª— -->
    <div id="custom-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="custom-confirm-title">ç¡®è®¤æ“ä½œ</h3>
            </div>
            <div class="modal-body">
                <p id="custom-confirm-text"></p>
            </div>
            <div class="modal-footer-split">
                <button id="custom-confirm-cancel-btn" class="modal-button secondary">å–æ¶ˆ</button>
                <button id="custom-confirm-ok-btn" class="modal-button primary">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- çº¢åŒ…è¯¦æƒ…å¼¹çª— -->
    <div id="red-packet-modal" class="modal-overlay hidden">
        <div class="red-packet-content">
            <button id="close-rp-modal-button" class="close-button">&times;</button>
            <div class="rp-header">
                <img id="rp-sender-avatar" class="avatar" src="">
                <p id="rp-sender-name"></p>
                <p id="rp-blessing"></p>
                <div class="rp-amount-line">
                    <span class="rp-currency">Â¥</span>
                    <span id="rp-amount">0.00</span>
                </div>
                <p class="rp-status-text">æ”¶åˆ°çš„çº¢åŒ…å·²å­˜å…¥ä½™é¢</p>
            </div>
            <div class="rp-footer">
                <div id="rp-receiver-list"></div>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰æç¤ºå¼¹çª— -->
    <div id="custom-alert-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="custom-alert-title">æç¤º</h3>
            </div>
            <div class="modal-body">
                <p id="custom-alert-text"></p>
            </div>
            <div class="modal-footer">
                <button id="custom-alert-ok-btn">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- å‘é€çº¢åŒ…å¼¹çª— -->
    <div id="red-packet-input-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å‘é€çº¢åŒ…</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="rp-input-blessing">ç¥ç¦è¯­</label>
                    <input type="text" id="rp-input-blessing" value="æ­å–œå‘è´¢">
                </div>
                <div class="form-group">
                    <label for="rp-input-amount">é‡‘é¢ (å…ƒ)</label>
                    <input type="number" id="rp-input-amount" placeholder="0.00" step="0.01">
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-rp-input-btn" class="modal-button secondary">å–æ¶ˆ</button>
                <button id="confirm-rp-input-btn" class="modal-button primary">å¡é’±è¿›çº¢åŒ…</button>
            </div>
        </div>
    </div>

    <!-- è®°å¿†æ€»ç»“ç¼–è¾‘å¼¹çª— -->
    <div id="summary-editor-modal" class="modal-overlay hidden">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>ç¼–è¾‘è®°å¿†æ€»ç»“</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>AIæ€»ç»“çš„è®°å¿†è‰ç¨¿ (YAMLæ ¼å¼):</label>
                    <textarea id="summary-editor-textarea" rows="12"></textarea>
                </div>
                <p id="summary-status-text" class="summary-status"></p>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-summary-btn" class="modal-button secondary">å–æ¶ˆ</button>
                <button id="copy-summary-btn" class="modal-button secondary">å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
                <button id="save-summary-btn" class="modal-button primary">å­˜å…¥AIè®°å¿†</button>
            </div>
        </div>
    </div>

    <!-- æ€»ç»“æ¨¡å¼é€‰æ‹©å¼¹çª— -->
    <div id="mode-select-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>è¯·é€‰æ‹©æ€»ç»“æ¨¡å¼</h3>
            </div>
            <div class="modal-body">
                <p>AIå°†æ ¹æ®ä½ é€‰æ‹©çš„æ¨¡å¼ï¼Œé‡‡ç”¨ä¸åŒçš„ä¾§é‡ç‚¹æ¥æ€»ç»“ä½ ä»¬çš„å¯¹è¯ã€‚</p>
                <div class="mode-select-buttons">
                    <button id="mode-online-btn" class="modal-button primary">çº¿ä¸Šé—²èŠæ¨¡å¼</button>
                    <button id="mode-offline-btn" class="modal-button secondary">çº¿ä¸‹å‰§æƒ…æ¨¡å¼</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‰‹åŠ¨æ€»ç»“èŒƒå›´è®¾ç½®å¼¹çª— -->
    <div id="summary-range-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ‰‹åŠ¨æ€»ç»“è®¾ç½®</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="summary-range-input">è¦æ€»ç»“æœ€è¿‘çš„å¤šå°‘æ¡æ¶ˆæ¯ï¼Ÿ</label>
                    <input type="number" id="summary-range-input" placeholder="ä¾‹å¦‚: 100">
                    <p style="font-size:12px; color:#999; margin-top:5px;">(ä¸å¡«åˆ™é»˜è®¤æ€»ç»“å…¨éƒ¨æ–°æ¶ˆæ¯)</p>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-summary-range-btn" class="modal-button secondary">å–æ¶ˆ</button>
                <button id="confirm-summary-range-btn" class="modal-button primary">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>
    </div>

    <!-- å…³ç³»ç¡®è®¤å¼¹çª— -->
    <div id="relationship-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="relationship-confirm-title">æƒ…ä¾£å…³ç³»é‚€è¯·</h3>
            </div>
            <div class="modal-body">
                <p id="relationship-confirm-text"></p>
            </div>
            <div class="modal-footer-split">
                <button id="relationship-confirm-refuse-btn" class="modal-button secondary">æ®‹å¿æ‹’ç»</button>
                <button id="relationship-confirm-accept-btn" class="modal-button primary">æ¥å—é‚€è¯·</button>
            </div>
        </div>
    </div>
    <!-- ã€ã€ã€å…¨æ–°ï¼šæ–‡æœ¬ç¼–è¾‘å¼¹çª—ã€‘ã€‘ã€‘ -->
    <div id="text-editor-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="text-editor-title">ç¼–è¾‘æ¶ˆæ¯</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <textarea id="text-editor-textarea" rows="5"></textarea>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-text-edit-btn" class="modal-button secondary">å–æ¶ˆ</button>
                <button id="save-text-edit-btn" class="modal-button primary">ä¿å­˜</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>

</body>
</html>
