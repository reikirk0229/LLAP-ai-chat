<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>IDIC实验室</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- 【【【全新：全局Toast提示】】】 -->
    <div id="global-toast" class="hidden">
        <span id="global-toast-text"></span>
    </div>

    <div id="app-container">

        <!-- 视图1: 消息列表 (默认视图) -->
        <div id="chat-list-view" class="view">
            <div class="header">
                <span>消息</span>
                <button id="add-contact-button" class="header-button">+</button>
            </div>
            <div id="chat-list-container"></div>
        </div>

        <!-- 视图2: 聊天窗口 -->
        <div id="chat-window-view" class="view hidden">
            <div class="header">
                <div id="chat-header-normal">
                    <button id="back-to-list-button" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                    <div id="chat-header-info">
                        <span id="chat-ai-name" class="clickable">AI 伙伴</span>
                        <div id="chat-ai-status-line">
                            <span class="online-indicator"></span>
                            <span id="chat-ai-status">在线</span>
                            <span id="chat-ai-activity-status"></span>
                        </div>
                    </div>
                    <button id="chat-settings-button" class="header-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
                </div>
                <div id="chat-header-select" class="hidden">
                    <button id="cancel-select-button" class="header-button-text">取消</button>
                    <span id="select-count">已选择0项</span>
                    <div>
                        <button id="edit-selected-button" class="header-button-text hidden">编辑</button>
                        <button id="delete-selected-button" class="header-button-text">删除</button>
                    </div>
                </div>
            </div>
            <div id="message-container"></div>
            <div id="ai-suggestion-panel" class="suggestion-panel hidden">
            </div>
            <div class="chat-input-area">
                <div id="refresh-suggestions-container" class="hidden">
                    <button id="refresh-suggestions-btn" title="换一批"></button>
                </div>
                <div class="chat-functions-toolbar">
                    <button id="voice-btn" class="tool-button" title="语音"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg></button>
                    <button id="image-btn" class="tool-button" title="图片"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></button>
                    <button id="camera-btn" class="tool-button" title="拍摄"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg></button>
                    <button id="red-packet-btn" class="tool-button" title="红包"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2.2c-5.5 0-10 2.4-10 6.8 0 2.4.6 4.6 2.4 6.4 1.8 2 4.2 2.6 4.2 4.6 0 1.1.9 2 2 2h2.8c1.1 0 2-.9 2-2 0-2 2.4-2.6 4.2-4.6 1.8-1.8 2.4-4 2.4-6.4 0-4.4-4.5-6.8-10-6.8z"></path><path d="M12 12.6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg></button>
                    <button id="emoji-btn" class="tool-button" title="表情"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M8 14s1.5 2 4 2 4-2 4-2"></path><line x1="9" y1="9" x2="9.01" y2="9"></line><line x1="15" y1="9" x2="15.01" y2="9"></line></svg></button>
                    <button id="ai-helper-button" class="tool-button" title="AI帮回"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"></path><rect x="4" y="4" width="16" height="16" rx="2"></rect><path d="M20 12h-4"></path><path d="M12 20v-4"></path></svg></button>
                    <button id="more-functions-button" class="tool-button" title="更多"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></button>
                </div>
                <div class="input-row">
                    <textarea id="chat-input" placeholder="输入消息..."></textarea>
                    <button id="send-button">发送</button>
                </div>
            </div>
            <div id="user-sticker-panel" class="sticker-panel"></div>
        </div>
        
        <!-- 视图3: 动态页面 -->
        <div id="moments-view" class="view hidden">
            <div class="header">
                 <button id="back-to-list-from-moments" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>动态</span>
            </div>
            <div class="moments-container">
                <div class="moments-header">
                    <img class="moments-banner" src="https://i.postimg.cc/L8y2zWc2/default-banner.jpg" alt="banner">
                    <div class="moments-user-info">
                        <span id="moments-user-name">你的昵称</span>
                        <img id="moments-user-avatar" class="avatar-lg" src="">
                    </div>
                </div>
                <div class="moments-nav">
                    <span>相册</span>
                    <span>说说</span>
                    <span>装扮</span>
                    <span>游戏</span>
                </div>
                <div class="moments-feed"></div>
                 <button id="create-post-button" class="fab">+</button>
            </div>
        </div>

        <!-- 视图4: 设置页面 (通用设置) -->
        <div id="settings-view" class="view hidden">
            <div class="header">
                 <button id="back-to-list-from-settings" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>设置</span>
            </div>
            <div id="settings-form">
                <div class="form-group"><label for="api-type-select">API 类型</label><select id="api-type-select"><option value="openai_proxy">OpenAI 格式 (推荐)</option><option value="gemini_direct" disabled>Google Gemini (暂不推荐)</option></select></div>
                <div class="form-group"><label for="api-url-input">API 地址 (URL)</label><input type="text" id="api-url-input" placeholder="根据所选类型填写"></div>
                <div class="form-group" id="model-area"><label>模型名称 (Model)</label><div class="model-selection-area"><select id="api-model-select"></select><button id="fetch-models-button">拉取</button></div></div>
                <div class="form-group"><label for="api-key-input">API 密钥 (Key)</label><input type="password" id="api-key-input" placeholder="粘贴你的密钥"></div>
                <div class="form-group">
                    <label for="context-limit-input">上下文记忆条数</label>
                    <input type="number" id="context-limit-input" placeholder="">
                </div>
                <hr>
                <h3>全局设置 (待开发)</h3>
                <p class="placeholder-text">未来可在这里添加全局预设、外观等设置。</p>
                <button id="save-settings-button">保存设置</button>
            </div>
        </div>

        <!-- 视图5: 单个联系人的聊天设置页面 -->
        <div id="contact-settings-view" class="view hidden">
            <div class="header">
                 <button id="back-to-chat-button" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>聊天设置</span>
            </div>
            <div class="contact-settings-container">
                <div class="settings-group">
                    <div class="settings-item contact-profile" id="cs-edit-ai-profile">
                        <img id="cs-contact-avatar" class="avatar" src="">
                        <span>对方信息</span>
                        <span class="arrow">&gt;</span>
                    </div>
                    <div class="settings-item contact-profile" id="cs-edit-my-profile">
                        <img id="cs-my-avatar" class="avatar" src="">
                        <span>我的身份</span>
                        <span class="arrow">&gt;</span>
                    </div>
                </div>
                <div class="settings-group">
                    <div class="settings-item"><span>设为置顶</span><label class="switch"><input type="checkbox" id="cs-pin-toggle"><span class="slider"></span></label></div>
                    <div class="settings-item">
                        <span>允许AI主动求爱</span>
                        <label class="switch"><input type="checkbox" id="cs-propose-toggle"><span class="slider"></span></label>
                    </div>
                    <div class="settings-item"><span>导出/导入聊天记录</span><span class="arrow">&gt;</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item"><span>设置AI动态频率</span><span class="arrow">&gt;</span></div>
                    <div class="settings-item"><span>设置AI主动消息频率</span><span class="arrow">&gt;</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item"><span>设置聊天背景</span><span class="arrow">&gt;</span></div>
                    <div class="settings-item"><span>设置气泡样式</span><span class="arrow">&gt;</span></div>
                    <div class="settings-item"><span>设置字体大小</span><span class="arrow">&gt;</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item" id="cs-message-count-item">
                        <span>当前对话条数</span>
                        <span id="cs-message-count">0</span>
                    </div>
                    <div class="settings-item">
                        <span>自动总结</span>
                        <div class="auto-summary-setting">
                            <div id="cs-auto-summary-display" class="summary-threshold-display">未设置</div>
                            <input type="number" id="cs-auto-summary-input" class="summary-threshold-input hidden" min="50">
                            <label class="switch"><input type="checkbox" id="cs-auto-summary-toggle"><span class="slider"></span></label>
                        </div>
                    </div>
                    <div class="settings-item" id="cs-summarize-chat">
                        <span>手动总结</span>
                        <span class="arrow">&gt;</span>
                    </div>
                </div>
                <div class="settings-group">
                    <div class="settings-item" id="cs-clear-history"><span class="danger">清空聊天记录</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item" id="cs-blacklist-contact"><span class="danger">将对方添加至黑名单</span></div>
                </div>
                <div class="settings-group">
                    <div class="settings-item" id="cs-delete-contact">
                        <span class="danger">删除该角色</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 视图6: AI信息编辑页面 -->
        <div id="ai-editor-view" class="view hidden">
            <div class="header">
                <button id="back-to-contact-settings-button" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>编辑AI信息</span>
            </div>
            <div id="ai-editor-form">
                <div class="form-group-horizontal">
                    <div class="form-group avatar-group">
                        <label>AI 头像</label>
                        <div class="image-upload-area avatar-upload" id="avatar-upload-area">
                            <img id="avatar-preview" class="image-preview" src="">
                            <span>点击上传</span>
                        </div>
                        <input type="file" id="avatar-upload-input" class="hidden-file-input" accept="image/*">
                    </div>
                    <div class="form-group photo-group">
                        <label>AI 照片</label>
                        <div class="image-upload-area photo-upload" id="photo-upload-area">
                            <img id="photo-preview" class="image-preview" src="">
                            <span>点击上传</span>
                        </div>
                        <input type="file" id="photo-upload-input" class="hidden-file-input" accept="image/*">
                    </div>
                </div>
                <div class="form-group">
                    <label for="ai-editor-name">AI 姓名</label>
                    <input type="text" id="ai-editor-name">
                </div>
                <div class="form-group">
                    <label for="ai-editor-remark">AI 备注</label>
                    <input type="text" id="ai-editor-remark">
                </div>
                <div class="form-group">
                    <label for="ai-editor-persona">AI的人设</label>
                    <textarea id="ai-editor-persona" rows="5"></textarea>
                </div>
                <div class="form-group">
                    <label for="ai-editor-chat-style">线上风格</label>
                    <textarea id="ai-editor-chat-style" rows="4" placeholder="e.g., 喜欢用短句，偶尔会发可爱的Emoji、颜文字和表情包。不爱发语音，打字很快。说话直接，不喜欢拐弯抹角。"></textarea>
                </div>
                <div class="form-group"><label>AI的专属记忆</label><textarea id="ai-editor-memory" rows="8" placeholder="对话总结等长期记忆..."></textarea></div>
                <div class="form-group">
                    <label>世界书</label>
                    <div id="ai-editor-worldbook"></div>
                    <button type="button" id="add-worldbook-entry-button">添加新条目</button>
                </div>
                <div class="form-group">
                    <label>可用表情包分组</label>
                    <div id="ai-sticker-groups-container">
                        <p class="placeholder-text">请先在 全局设置 -> AI表情包管理 中添加分组</p>
                    </div>
                </div>
                <button id="save-ai-profile-button">保存</button>
            </div>
        </div>

        <!-- 视图7: AI表情包管理页面 -->
        <div id="ai-sticker-manager-view" class="view hidden">
            <div class="header">
                <button id="back-to-settings-from-sticker-btn" class="header-button back-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button>
                <span>AI表情包管理</span>
            </div>
            <div id="sticker-manager-container"></div>
            <button id="add-sticker-group-btn" class="fab">+</button>
        </div>

        <!-- 【【【核心修正：导航栏现在是app-container的最后一个孩子】】】 -->
        <div id="app-nav">
            <div class="nav-button active" data-view="chat-list-view">消息</div>
            <div class="nav-button" data-view="moments-view">动态</div>
            <div class="nav-button" data-view="settings-view">设置</div>
        </div>

    </div> <!-- ▲▲▲ #app-container 到此彻底结束 ▲▲▲ -->

    <!-- ############################################################### -->
    <!-- #####          所有的弹窗(Modal)都应该放在这里            ##### -->
    <!-- #####         作为 app-container 的兄弟，而不是孩子         ##### -->
    <!-- ############################################################### -->

    <!-- 用户信息修改弹窗 -->
    <div id="user-profile-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header"><h3>修改我的信息</h3><button id="close-modal-button" class="close-button">&times;</button></div>
            <div class="modal-body">
                <div class="form-group">
                    <label>我的头像</label>
                    <div class="image-upload-area user-avatar-upload" id="user-avatar-upload-area">
                        <img id="user-avatar-preview" class="image-preview" src="">
                        <span>点击上传</span>
                    </div>
                    <input type="file" id="user-avatar-upload-input" class="hidden-file-input" accept="image/*">
                </div>
                <div class="form-group"><label for="modal-user-name-input">我的昵称</label><input type="text" id="modal-user-name-input"></div>
                <div class="form-group"><label for="modal-user-persona-input">我的人设</label><textarea id="modal-user-persona-input" rows="4"></textarea></div>
            </div>
            <div class="modal-footer"><button id="save-profile-button">保存</button></div>
        </div>
    </div> 

    <!-- 表情包上传弹窗 -->
    <div id="sticker-upload-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="sticker-upload-title">添加表情包</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>表情预览</label>
                    <div class="image-upload-area sticker-preview-area">
                        <img id="sticker-upload-preview" class="image-preview" src="">
                    </div>
                </div>
                <div class="form-group">
                    <label for="sticker-upload-url-input">图片地址 (URL)</label>
                    <input type="text" id="sticker-upload-url-input" placeholder="粘贴URL或选择本地文件">
                </div>
                 <div class="form-group">
                    <label for="sticker-upload-file-input" class="button-like-label">从本地上传</label>
                    <input type="file" id="sticker-upload-file-input" class="hidden-file-input" accept="image/*">
                </div>
                <div class="form-group">
                    <label for="sticker-upload-desc-input">表情描述 (给AI看)</label>
                    <textarea id="sticker-upload-desc-input" rows="3" placeholder="例如：一只微笑的柴犬"></textarea>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-sticker-upload-btn" class="modal-button secondary">取消</button>
                <button id="confirm-sticker-upload-btn" class="modal-button primary">保存</button>
            </div>
        </div>
    </div>
     
    <!-- 发送语音弹窗 -->
    <div id="voice-input-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>发送语音</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="voice-text-input">请输入你想说的内容:</label>
                    <textarea id="voice-text-input" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-voice-button" class="modal-button secondary">取消</button>
                <button id="confirm-voice-button" class="modal-button primary">确定</button>
            </div>
        </div>
    </div>

    <!-- AI图片描述弹窗 -->
    <div id="ai-image-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>照片描述</h3>
            </div>
            <div class="modal-body">
                <p id="ai-image-description-text"></p>
            </div>
            <div class="modal-footer">
                <button id="close-ai-image-modal-button">好的</button>
            </div>
        </div>
    </div>

    <!-- 用户上传/模拟图片弹窗 -->
    <div id="image-upload-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="image-upload-title">发送图片</h3>
            </div>
            <div class="modal-body">
                <div class="form-group" id="image-preview-area">
                    <div class="image-upload-area" id="user-image-upload-area">
                        <img id="user-image-preview" class="image-preview" src="">
                        <span>点击上传</span>
                    </div>
                    <input type="file" id="user-image-upload-input" class="hidden-file-input" accept="image/*">
                </div>
                <div class="form-group" id="image-description-group">
                    <textarea id="image-description-input" rows="3" placeholder="可以对图片进行提问或补充说明..."></textarea>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-image-upload-button" class="modal-button secondary">取消</button>
                <button id="confirm-image-upload-button" class="modal-button primary">发送</button>
            </div>
        </div>
    </div>

    <!-- 自定义确认弹窗 -->
    <div id="custom-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="custom-confirm-title">确认操作</h3>
            </div>
            <div class="modal-body">
                <p id="custom-confirm-text"></p>
            </div>
            <div class="modal-footer-split">
                <button id="custom-confirm-cancel-btn" class="modal-button secondary">取消</button>
                <button id="custom-confirm-ok-btn" class="modal-button primary">确定</button>
            </div>
        </div>
    </div>

    <!-- 红包详情弹窗 -->
    <div id="red-packet-modal" class="modal-overlay hidden">
        <div class="red-packet-content">
            <button id="close-rp-modal-button" class="close-button">&times;</button>
            <div class="rp-header">
                <img id="rp-sender-avatar" class="avatar" src="">
                <p id="rp-sender-name"></p>
                <p id="rp-blessing"></p>
                <div class="rp-amount-line">
                    <span class="rp-currency">¥</span>
                    <span id="rp-amount">0.00</span>
                </div>
                <p class="rp-status-text">收到的红包已存入余额</p>
            </div>
            <div class="rp-footer">
                <div id="rp-receiver-list"></div>
            </div>
        </div>
    </div>

    <!-- 自定义提示弹窗 -->
    <div id="custom-alert-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="custom-alert-title">提示</h3>
            </div>
            <div class="modal-body">
                <p id="custom-alert-text"></p>
            </div>
            <div class="modal-footer">
                <button id="custom-alert-ok-btn">确定</button>
            </div>
        </div>
    </div>

    <!-- 发送红包弹窗 -->
    <div id="red-packet-input-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>发送红包</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="rp-input-blessing">祝福语</label>
                    <input type="text" id="rp-input-blessing" value="恭喜发财">
                </div>
                <div class="form-group">
                    <label for="rp-input-amount">金额 (元)</label>
                    <input type="number" id="rp-input-amount" placeholder="0.00" step="0.01">
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-rp-input-btn" class="modal-button secondary">取消</button>
                <button id="confirm-rp-input-btn" class="modal-button primary">塞钱进红包</button>
            </div>
        </div>
    </div>

    <!-- 记忆总结编辑弹窗 -->
    <div id="summary-editor-modal" class="modal-overlay hidden">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>编辑记忆总结</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>AI总结的记忆草稿 (YAML格式):</label>
                    <textarea id="summary-editor-textarea" rows="12"></textarea>
                </div>
                <p id="summary-status-text" class="summary-status"></p>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-summary-btn" class="modal-button secondary">取消</button>
                <button id="copy-summary-btn" class="modal-button secondary">复制到剪贴板</button>
                <button id="save-summary-btn" class="modal-button primary">存入AI记忆</button>
            </div>
        </div>
    </div>

    <!-- 总结模式选择弹窗 -->
    <div id="mode-select-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>请选择总结模式</h3>
            </div>
            <div class="modal-body">
                <p>AI将根据你选择的模式，采用不同的侧重点来总结你们的对话。</p>
                <div class="mode-select-buttons">
                    <button id="mode-online-btn" class="modal-button primary">线上闲聊模式</button>
                    <button id="mode-offline-btn" class="modal-button secondary">线下剧情模式</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 手动总结范围设置弹窗 -->
    <div id="summary-range-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>手动总结设置</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="summary-range-input">要总结最近的多少条消息？</label>
                    <input type="number" id="summary-range-input" placeholder="例如: 100">
                    <p style="font-size:12px; color:#999; margin-top:5px;">(不填则默认总结全部新消息)</p>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-summary-range-btn" class="modal-button secondary">取消</button>
                <button id="confirm-summary-range-btn" class="modal-button primary">下一步</button>
            </div>
        </div>
    </div>

    <!-- 关系确认弹窗 -->
    <div id="relationship-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="relationship-confirm-title">情侣关系邀请</h3>
            </div>
            <div class="modal-body">
                <p id="relationship-confirm-text"></p>
            </div>
            <div class="modal-footer-split">
                <button id="relationship-confirm-refuse-btn" class="modal-button secondary">残忍拒绝</button>
                <button id="relationship-confirm-accept-btn" class="modal-button primary">接受邀请</button>
            </div>
        </div>
    </div>
    <!-- 【【【全新：文本编辑弹窗】】】 -->
    <div id="text-editor-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="text-editor-title">编辑消息</h3>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <textarea id="text-editor-textarea" rows="5"></textarea>
                </div>
            </div>
            <div class="modal-footer-split">
                <button id="cancel-text-edit-btn" class="modal-button secondary">取消</button>
                <button id="save-text-edit-btn" class="modal-button primary">保存</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>

</body>
</html>
